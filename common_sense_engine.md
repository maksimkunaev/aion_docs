# Common Sense Engine
## Проект создания системы причинно-следственного рассуждения

### Описание проекта

Common Sense Engine — это экспериментальная система для создания ИИ, способного к причинно-следственным рассуждениям и пониманию базовой физики мира без формальных моделей. Проект решает фундаментальную проблему современных LLM: отсутствие понимания простых физических закономерностей и причинно-следственных связей.

### Проблематика

Современные языковые модели демонстрируют удивительные способности в генерации текста, но часто не понимают базовые физические принципы:
- Стаканы падают и не разбиваются
- Люди летают вверх
- Объекты проходят сквозь стены
- Нарушаются простые причинно-следственные связи

Причина в том, что модели учатся на тексте, где очевидные связи не проговариваются явно. Например, в тексте "стакан разбился" не упоминается, что он упал, хотя это очевидная причина.

### Философия подхода

Проект основан на идее, что разум можно построить не через формальную логику, а через эмпирический опыт, как это делают животные, древние люди или R2D2. Система должна "чувствовать" мир через внутренние модели состояний, а не знать формальные правила.

---

## Архитектура системы

### Общая концепция

Система представляет мир как последовательность состояний во времени:
```
[State1] → [Action] → [State2] → [Action] → [State3] → ...
```

Каждое состояние содержит:
- **Entities** — объекты в мире
- **Properties** — свойства объектов
- **Relationships** — отношения между объектами
- **Actions** — действия, изменяющие состояния

### Модульная архитектура

```
Text Input → [Text Parser] → [World Model] → [Action Pattern Generator] → [Cause-Effect Engine] → Reasoning Output
```

---

## Компоненты системы

### 1. Text Parser (Текстовый парсер)

**Назначение**: Извлечение структурированной информации из естественного языка

**Вход**: Текст на естественном языке
**Выход**: Неполная мировая модель

**Пример**:
```
Вход: "Alice sat on the bank next to her sister"
Выход: 
{
  "entities": ["Alice", "bank", "sister"],
  "relations": ["Alice-on-bank", "Alice-next-to-sister"]
}
```

**Технические детали**:
- Использует LLM для извлечения сущностей и отношений
- Работает с финитными словарями типов объектов
- Создает базовый граф связей

### 2. World Model (Мировая модель)

**Назначение**: Расширение неполной модели до полной по запросу

**Концепция**: 
- **Неполная модель**: "Алиса рядом с сестрой" (2 отношения)
- **Полная модель**: все возможные отношения между всеми объектами сцены

**Типы запросов**:
- `select(entity_set)` — связи между выбранными объектами
- `expand_context(entity)` — весь контекст объекта
- `get_relation(A, B)` — связь между двумя объектами

**Пример работы**:
```
Запрос: ["Alice", "bank", "sister", "book"]
Ответ: [
  {"Alice": "near-sister"},
  {"sister": "holding-book"}, 
  {"Alice": "on-bank"},
  {"book": "on-bank"},
  {"sister": "on-bank"}
]
```

**Базовые пространственные предикаты**:
- `near(A, B)` — рядом
- `between(A, B, C)` — между
- `inside(A, B)` — внутри
- `moved_from(A, B)` — переместился от
- `moved_to(A, B)` — переместился к

### 3. Action Pattern Generator

**Назначение**: Создание последовательности состояний для действий

**Функции**:
- Разбивает действие на микро-шаги
- Создает цепочку State1 → State2 → State3
- Работает без абсолютных координат

**Пример**:
```
Действие: "Rabbit runs to rabbit hole"
Паттерн:
[
  {"Rabbit": "near-Alice"},
  {"Rabbit": "on-field"}, 
  {"Rabbit": "near-rabbit-hole"}
]
```

### 4. Cause-Effect Engine (Движок причинно-следственных связей)

**Назначение**: Выполнение рассуждений над моделями состояний

**Типы рассуждений**:
1. **Прямое предсказание**: State + Action → New State  
2. **Обратное рассуждение**: Effect → возможные Causes
3. **Контрфактуальное**: "что если" сценарии
4. **Планирование**: Goal → последовательность Actions

---

## Уровни рассуждений

### Базовые уровни (6 типов):

1. **Retrieval** — поиск информации в состояниях
2. **Retrieval with Conditions** — условный поиск  
3. **Temporal Reasoning** — рассуждения во времени
4. **Comparative/Quantitative** — сравнения и количества
5. **Causal Reasoning** — причинно-следственные связи
6. **Planning** — планирование действий

### Двухуровневая модель reasoning:

- **Уровень 1**: Простые логические паттерны (IF-THEN по типам)
- **Уровень 2**: Контекстные зависимости через LLM

---

## Форматы данных

### Состояние (State)

```json
{
  "timestamp": "t1",
  "entities": {
    "Alice": {
      "type": "Person",
      "location": "bank",
      "properties": ["sitting"],
      "relations": {"near": "sister"}
    },
    "sister": {
      "type": "Person", 
      "location": "bank",
      "activity": "reading"
    }
  }
}
```

### Действие (Action)

```json
{
  "action": "move",
  "agent": "Alice",
  "target": "rabbit_hole",
  "parameters": {
    "method": "running",
    "path": "field"
  }
}
```

### Причинно-следственная связь

```json
{
  "if": {"entity_type": "Glass", "action": "falls"},
  "then": {"entity.state": "broken"}
}
```

---

## Этапы разработки

### Этап 1: Pattern Generation
**Цель**: Научить систему парсить действия в цепочки состояний

**Задачи**:
- Реализовать Text Parser
- Создать базу паттернов для типичных действий
- Обучить модель на простых примерах

**Тест-кейс**: 
```
"Стакан упал" → [
  {"Glass": "on-table"},
  {"Glass": "falling"}, 
  {"Glass": "on-floor", "state": "broken"}
]
```

### Этап 2: Cause-and-Effect Reasoning  
**Цель**: Добавить предсказание эффектов и планирование

**Задачи**:
- Построить базу причинно-следственных связей
- Реализовать Cause-Effect Engine
- Добавить контрфактуальные рассуждения

**Тест-кейс**:
```
Вопрос: "Что будет, если Алиса побежит за кроликом?"
Ответ: генерация цепочки состояний с перемещением Алисы
```

---

## Источники данных и обучение

### Проблема данных
**Основная сложность**: Очевидные причинно-следственные связи не записываются в текстах

**Подходы к решению**:

1. **Ручная генерация** (100-300 примеров)
   - Создание ядра референтных связей
   - Стандартизация формата

2. **Генерация по шаблонам**
   - Entity(type) + Action + Effect
   - Комбинаторная генерация по типам

3. **Извлечение из инструкций**
   - Рецепты, руководства
   - Игровые сценарии

4. **LLM как предгенератор**
   - Генерация базовых паттернов
   - Последующая фильтрация

### Базовые причинно-следственные связи

```
Упал → оказался на земле
Выпил воду → утолил жажду  
Включил свет → стало светло
Разбил стакан → появились осколки
Открыл дверь → появилась возможность пройти
```

---

## Тестирование системы

### Тест-кейс: "Алиса в стране чудес"

**Базовый сценарий**:
```
"Алиса сидела на берегу рядом с сестрой, которая читала книгу. 
Рядом с Алисой пробежал кролик. Он побежал к кроличьей норе."
```

**Типы тестов**:

1. **Прямая проверка**: "Почему Алисе стало скучно?"
2. **Скрытые связи**: "Почему она посмотрела в книгу?"  
3. **Контрфакты**: "Что если бы в книге были картинки?"
4. **Инверсное рассуждение**: "Что привело к появлению кролика?"

**Итоговый тест**:
```
Вопрос: "Что будет, если Алиса встанет и побежит за кроликом?"
Ожидаемый ответ: система генерирует паттерн движения Алисы
Проверочный вопрос: "Сколько людей осталось на берегу?"
Ответ: "Один" (сестра)
```

---

## Технические особенности

### Использование LLM
- **Парсинг**: извлечение структур из текста
- **Расширение контекста**: достраивание мировой модели
- **Генерация**: создание паттернов действий
- **Комбинированный формат**: [Alice:Person] для типизации

### Отказ от абсолютных координат
**Вместо**: `x: 10, y: 15`  
**Используем**: `near(Alice, sister)`, `between(Alice, bank, hole)`

**Преимущества**:
- Проще обучение
- Лучше обобщение  
- Нет необходимости в точных данных

### Модульность
Каждый компонент может развиваться независимо:
- Parser можно улучшать
- World Model можно расширять
- Reasoning Engine можно дообучать

---

## Перспективы развития

### Краткосрочные цели
- [ ] Реализация Text Parser
- [ ] Базовая World Model с 50 отношениями
- [ ] Action Pattern Generator для 10 действий
- [ ] Тестирование на примерах из "Алисы"

### Среднесрочные цели  
- [ ] Расширение до 1000+ причинно-следственных связей
- [ ] Интеграция с внешними источниками знаний
- [ ] Обучение на больших корпусах текстов
- [ ] Добавление временного reasoning

### Долгосрочная перспектива
- [ ] Создание полноценного reasoning-движка
- [ ] Интеграция с робототехникой
- [ ] Применение в игровых мирах
- [ ] Масштабирование до сложных сценариев

---

## Заключение

Common Sense Engine представляет собой новый подход к созданию ИИ-систем, способных к естественному пониманию мира через эмпирический опыт, а не формальные правила. Проект находится на стадии разработки MVP и демонстрирует многообещающие результаты в решении фундаментальных проблем понимания физического мира современными AI-системами.

**Ключевые инновации**:
- Представление мира как временных последовательностей состояний
- Модульная архитектура reasoning-системы  
- Относительные пространственные отношения вместо координат
- Двухуровневая модель причинно-следственных рассуждений

Проект открыт для сотрудничества и дальнейшего развития в направлении создания ИИ с естественным пониманием физического мира.